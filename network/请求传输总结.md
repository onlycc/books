# 总结

- 用户输入网址；

- 浏览器解析网址，生成HTTP消息并转发给Socket库；
  > HTTP消息

- 浏览器会使用Socket库中的解析器，向DNS服务器查询的域名的IP地址；

- Socket库将收到的HTTP消息作为数据转交给协议栈；

- TCP按照网络包的长度对数据进行拆分，在每一个包前面加上TCP头部并转交给IP;
  > TCP + HTTP数据块

- IP在TCP包前面加上IP头部，然后查询MAC地址并加上MAC头部，然后将包转交给网卡驱动；
  > Web服务器的IP地址，最近的路由器的MAC地址；
   MAC + IP + TCP + HTTP数据块

- 网卡驱动收到IP发来的包，将其转交给网卡并发出发送指令；

- 网卡检查以太网的可发送状态，将包转换成电信号通过双绞线发送出去；

- 信号通过双绞线到达集线器；

- 集线器将信号广播到所有端口，这样信号便到达了交换机；

- 交换机根据收到的包的接收方MAC地址查询自身的地址表找到输出端口，并将包转发到输出端口；
 >  MAC + IP + TCP + HTTP数据块

- 互联网接入路由器根据收到的包的接收方IP地址查询自身的路由表找到输出端口，将包转发到输出端口；

- 互联网接入路由器输出到互联网的包带有PPPoE头部和PPP头部；
  > BAS的MAC地址
  > MAC + PPPoE + PPP + IP + TCP + HTTP数据块

- ADSL Modem将收到的包拆分成ATM信元；

- ADSL Modem将拆分后的ATM信元转换成电信号通过电话线发送出去；

- ADSL Modem发送的信号经过电线杆上的电话线到达电话局的DSLAM（局端多路Modem）；

- DSLAM将收到的电信号还原成ATM信元并发送给BAS；

- BAS将ATM信元还原成网络包，根据接收方IP地址进行转发；

- BAS转发的包被加上了L2TP头部并通过隧道；

- 网络包到达位于隧道出口的隧道路由器，L2TP头部和PPP头部被丢弃，通过互联网流向Web服务器；

- 服务器端的局域网中有防火墙，对进入的包进行检查，判断是否允许通过；
  > 缓存服务器或Web服务器的MAC地址

- Web服务器前面如果有缓存服务器，会拦截通过防护墙的包。如果用户请求的页面已经缓存在服务器上，则代替服务器向用户返回页面数据；

- 如果请求的页面没有被缓存，缓存服务器会将请求转发给Web服务器；

- Web服务器收到包后，网卡和网卡驱动会接收这个包并转交给协议栈；

- 协议栈依次检查IP头部和TCP头部，如果没有问题就取出HTTP消息的数据块并进行组装；

- HTTP消息被恢复成原始形态，然后通过Socket库转发给Web服务器；
 > HTTP消息

- Web服务器分析HTTP消息的内容，并根据请求内容将读取的数据返回给客户端；
请求的上下文：User-Agent
指明客户端的类型信息，服务器可以据此对资源的表述做抉择。
